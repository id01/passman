function challengeSubmitAction(e){e.preventDefault();var t=document.getElementById("notification");t.style.color="",t.innerHTML="Please wait...";var n=document.getElementById("challengeform");n.querySelector("[name=userhash]").value=md5(n.querySelector("[name=userin]").value.toLowerCase()),jQuery.post(urllocation+"addpass_challenge.php","userhash="+n.querySelector("[name=userhash]").value+"&account="+md5(n.querySelector("[name=account]").value.toLowerCase()),buildVerifyForm,"text")}function makePassword(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789.!",n=new Uint8Array(1),r=0;r<document.getElementById("plength").value;r++)window.crypto.getRandomValues(n),e+=t.charAt(n[0]>>2);return e}function buildVerifyForm(e){document.getElementById("password_input").value;document.getElementById("verifyform").querySelector("[name=userhash]").value=document.getElementById("challengeform").querySelector("[name=userhash]").value;var t=e.split("\n");return document.getElementById("challenge").value=t[0],t[1].startsWith("VALID")?(document.getElementById("notification").innerHTML+=' <span id="notif_text">Decrypting Secrets...</span><span id="notif_status"></span>',void setTimeout(function(){try{var e=document.getElementById("password_input").value;document.getElementById("ecckey").value=hex.fromBits(sjcldecrypt(b64.toBits(t[1].substring(6)),e))}catch(n){return document.getElementById("notification").style.color="red",void(document.getElementById("notification").innerHTML="Incorrect Password.")}document.getElementById("notif_text").innerHTML="Encrypting Password...",setTimeout(function(){document.getElementById("decrypted").value=makePassword(),document.getElementById("encryptedpass").value=b64.fromBits(sjclencrypt(str.toBits(document.getElementById("decrypted").value),e)),document.getElementById("notif_text").innerHTML="Signing... ",setTimeout(function(){var e=document.getElementById("ecckey").value,t=new KJUR.crypto.Signature({alg:"SHA256withECDSA"});t.init({d:e,curve:"secp256k1"}),t.updateString(document.getElementById("challenge").value+"$"+md5(document.getElementById("account_input").value.toLowerCase())+"$"+document.getElementById("encryptedpass").value);var n=t.sign(),r=btoa(n.match(/\w{2}/g).map(function(e){return String.fromCharCode(parseInt(e,16))}).join(""));document.getElementById("signature").value=r,setTimeout(verifySubmitAction,20)},20)},20)},20)):(document.getElementById("notification").style.color="red",void(document.getElementById("notification").innerHTML=t[1]))}function verifySubmitAction(){var e=document.getElementById("verifyform");jQuery.post(urllocation+"addpass_verify.php","userhash="+e.querySelector("[name=userhash]").value+"&passwordcrypt="+e.querySelector("[name=passwordcrypt]").value.replace(/\+/g,"%2B")+"&signature="+e.querySelector("[name=signature]").value.replace(/\+/g,"%2B"),printVerifyResult,"text")}function printVerifyResult(e){var t=document.getElementById("notification");t.style.color="red",e.startsWith("Password already exists!")||e.startsWith("Invalid Signature")?t.innerHTML="Result: "+e:""==e?t.innerHTML="Unknown Error.":(t.style.color="green",t.innerHTML="Result: "+e)}function copyAction(){var e=document.getElementById("decrypted");e.disabled="",e.type="text",e.select(),document.execCommand("copy"),e.type="password",e.disabled="true"}