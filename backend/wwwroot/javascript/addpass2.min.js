function updateStatus(e){var t=document.getElementById("notif_status");t.innerHTML=e.what+" - "+e.i/e.total+"..."}function challengeSubmitAction(e){e.preventDefault();var t=document.getElementById("notification");t.style.color="",t.innerHTML="Please wait...";var n=document.getElementById("challengeform");n.querySelector("[name=userhash]").value=md5(n.querySelector("[name=userin]").value),jQuery.post("addpass_challenge.php","userhash="+n.querySelector("[name=userhash]").value+"&account="+md5(n.querySelector("[name=account]").value),buildVerifyForm,"text")}function makePassword(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789.!",n=0;n<document.getElementById("plength").value;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function buildVerifyForm(e){document.getElementById("password_input").value;document.getElementById("verifyform").querySelector("[name=userhash]").value=document.getElementById("challengeform").querySelector("[name=userhash]").value;var t=e.split("\n");return document.getElementById("challenge").value=t[0],t[1].startsWith("VALID")?(document.getElementById("notification").innerHTML+=' <span id="notif_text">Decrypting Secrets...</span><span id="notif_status"></span>',void triplesec.decrypt({data:new triplesec.Buffer(t[1].substring(6),"base64"),key:new triplesec.Buffer(document.getElementById("password_input").value),progress_hook:updateStatus},function(e,t){e?(document.getElementById("notification").style.color="red",document.getElementById("notification").innerHTML="Incorrect Password."):(document.getElementById("ecckey").value=t.toString("hex"),document.getElementById("notif_text").innerHTML="Encrypting Password...",document.getElementById("decrypted").value=makePassword(),triplesec.encrypt({data:new triplesec.Buffer(document.getElementById("decrypted").value),key:new triplesec.Buffer(document.getElementById("password_input").value),progress_hook:updateStatus},function(e,t){if(e)document.getElementById("notification").style.color="red",document.getElementById("notification").innerHTML="Encryption Error: "+e;else{document.getElementById("encryptedpass").value=t.toString("base64"),document.getElementById("notif_text").innerHTML="Signing... ";var n=document.getElementById("ecckey").value,r=new KJUR.crypto.Signature({alg:"SHA256withECDSA"});r.init({d:n,curve:"secp256k1"}),r.updateString(document.getElementById("challenge").value+"$"+md5(document.getElementById("account_input").value)+"$"+document.getElementById("encryptedpass").value);var o=r.sign(),a=btoa(o.match(/\w{2}/g).map(function(e){return String.fromCharCode(parseInt(e,16))}).join(""));document.getElementById("signature").value=a,verifySubmitAction()}}))})):(document.getElementById("notification").style.color="red",void(document.getElementById("notification").innerHTML=t[1]))}function verifySubmitAction(){var e=document.getElementById("verifyform");jQuery.post("addpass_verify.php","userhash="+e.querySelector("[name=userhash]").value+"&passwordcrypt="+e.querySelector("[name=passwordcrypt]").value.replace(/\+/g,"%2B")+"&signature="+e.querySelector("[name=signature]").value.replace(/\+/g,"%2B"),printVerifyResult,"text")}function printVerifyResult(e){var t=document.getElementById("notification");t.style.color="red",e.startsWith("Password already exists!")||e.startsWith("Invalid Signature")?t.innerHTML="Result: "+e:""==e?t.innerHTML="Unknown Error.":(t.style.color="green",t.innerHTML="Result: "+e)}function copyAction(){}