"use strict";var sjcl2={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};
"undefined"!==typeof module&&module.exports&&(module.exports=sjcl2);"function"===typeof define&&define([],function(){return sjcl2});
sjcl2.bitArray={bitSlice:function(a,b,d){a=sjcl2.bitArray.e(a.slice(b/32),32-(b&31)).slice(1);return void 0===d?a:sjcl2.bitArray.clamp(a,d-b)},extract:function(a,b,d){var c=Math.floor(-b-d&31);return((b+d-1^b)&-32?a[b/32|0]<<32-c^a[b/32+1|0]>>>c:a[b/32|0]>>>c)&(1<<d)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var d=a[a.length-1],c=sjcl2.bitArray.getPartial(d);return 32===c?a.concat(b):sjcl2.bitArray.e(b,c,d|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===
b?0:32*(b-1)+sjcl2.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var d=a.length;b&=31;0<d&&b&&(a[d-1]=sjcl2.bitArray.partial(b,a[d-1]&2147483648>>b-1,1));return a},partial:function(a,b,d){return 32===a?b:(d?b|0:b<<32-a)+0x10000000000*a},getPartial:function(a){return Math.round(a/0x10000000000)||32},equal:function(a,b){if(sjcl2.bitArray.bitLength(a)!==sjcl2.bitArray.bitLength(b))return!1;var d=0,c;for(c=0;c<a.length;c++)d|=a[c]^b[c];return 0===
d},e:function(a,b,d,c){var e;e=0;for(void 0===c&&(c=[]);32<=b;b-=32)c.push(d),d=0;if(0===b)return c.concat(a);for(e=0;e<a.length;e++)c.push(d|a[e]>>>b),d=a[e]<<32-b;e=a.length?a[a.length-1]:0;a=sjcl2.bitArray.getPartial(e);c.push(sjcl2.bitArray.partial(b+a&31,32<b+a?d:c.pop(),1));return c},g:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(a){var b,d;for(b=0;b<a.length;++b)d=a[b],a[b]=d>>>24|d>>>8&0xff00|(d&0xff00)<<8|d<<24;return a}};
sjcl2.cipher.stream=function(){function a(a,b,h,d){var f=d/32,c,e,n=0,l;d&=31;e=Math.min(h.length,b.length-f)-1;if(d)for(c=n=0;c<e;++c,++f)l=h[c],b[f]^=l>>>d^n,n=l<<32-d;else for(c=0;c<e;++c,++f)b[f]^=h[c];l=p(b[f]);b[f]^=h[c]>>>d^n;32!==l&&(c=f,f=b[f],f=32===l?f|0:k(l,2147483648>>l-1&f,1),b[c]=f);e=32*e+l-d;a.b=m(h,e);0===a.b.length&&(a.b=null);return e}function b(b){b=b.slice(0);var h=0,d=e(b);for(this.b&&(h+=a(this,b,this.b,h));h<d;){if(this.b)throw new c("_mask must be null");h+=a(this,b,this.nextMask(),
h)}return b}var d=sjcl2.exception.invalid,c=sjcl2.exception.bug,e=sjcl2.bitArray.bitLength,p=sjcl2.bitArray.getPartial,k=sjcl2.bitArray.partial,m=sjcl2.bitArray.bitSlice,h;h={blockBits:0,nextMask:function(){throw new d("nextMask not implemented");},crypt:b,encrypt:b,decrypt:b,setPosition:function(b){if(!this.setBlock)throw new c("(this) stream cipher can't seek position");var a=b%this.blockBits;this.setBlock((b-a)/this.blockBits);0===a?this.b=null:(this.b=this.nextMask(),m(this.b,a))},getPosition:function(){if(!this.getBlock)throw new c("(this) stream cipher can't tell position");
var b=this.b?e(this.b):0;return this.getBlock()*this.blockBits-b}};return function(b){for(var a in h)h.hasOwnProperty(a)&&(this[a]=h[a]);for(a in b)b.hasOwnProperty(a)&&(this[a]=b[a])}}();
sjcl2.cipher.salsa20=function(){function a(a,b,c){this.c=c||20;if(8!==this.c&&12!==this.c&&20!==this.c)throw new d("invalid number of rounds for (X)Salsa20");this.a=m(a,b,this.c);this.f=this.a.slice(0);this.d=!1}function b(a,b,d){var c;if(d)for(c=0;16>c;++c)d[c]=a[c];else d=a.slice(0);c=d;var e,f,k,q,n,l,m,r;for(b=b||20;0<b;b-=2)for(f=0;32>f;)m=p[f++],q=p[f++],n=p[f++],r=p[f++],e=(k=c[m])+(l=c[r]),c[q]=q=c[q]^(e<<7|e>>>25),e=q+k^0,c[n]=n=c[n]^(e<<9|e>>>23),e=n+q,c[r]=l^=e<<13|e>>>19,e=l+n,c[m]=k^(e<<
18|e>>>14);for(c=0;16>c;++c)d[c]=d[c]+a[c]^0;return d}var d=sjcl2.exception.invalid,c=sjcl2.exception.bug,e=sjcl2.bitArray.byteswapM,p,k,m;p=[0,4,8,12,5,9,13,1,10,14,2,6,15,3,7,11,0,1,2,3,5,6,7,4,10,11,8,9,15,12,13,14];k=[1634760805,857760878,2036477234,1797285236];m=function(a,c,g){var m=k[1],p=k[2];a=e(a.slice(0));c=c?e(c.slice(0)):[0,0];if(6===c.length&&8===a.length){var f;a=[k[0],a[0],a[1],a[2],a[3],k[1],c[0],c[1],c[2],c[3],k[2],a[4],a[5],a[6],a[7],k[3]];g=b(a,g);for(f=0;16>f;++f)g[f]=g[f]-a[f]^
0;a=[g[0],g[5],g[10],g[15],g[6],g[7],g[8],g[9]];c[0]=c[4];c[1]=c[5]}else if(2!==c.length)throw new d("invalid salsa20 nonce size");if(4===a.length)m^=33554432,p^=4,g=a;else if(8===a.length)g=a,a=a.slice(4);else throw new d("invalid salsa20 key size");return[k[0],g[0],g[1],g[2],g[3],m,c[0],c[1],0,0,p,a[0],a[1],a[2],a[3],k[3]]};a.core=b;a.prototype=new sjcl2.cipher.stream({blockBits:512,nextMask:function(){if(this.d)throw new d("Salsa20 stream cipher reached maximum message length");var a=e(b(this.a,
this.c,this.f));this.d=0===(this.a[8]=this.a[8]+1^0)&&0===(this.a[9]=this.a[9]+1^0);return a},setBlock:function(a){this.setBlock2(a,0)},getBlock:function(){if(this.a[9])throw new c("block index doesn't fit in 32 bits");return this.a[8]},setBlock2:function(a,b){this.a[8]=a^0;this.a[9]=b^0;this.d=!1}});return a}();
