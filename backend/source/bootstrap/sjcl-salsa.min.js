sjcl.cipher.stream=function(){var l=sjcl.exception.invalid,s=sjcl.exception.bug,r=sjcl.bitArray.bitLength,a=sjcl.bitArray.getPartial,o=sjcl.bitArray.partial,n=sjcl.bitArray.bitSlice,t;function h(t,i,s){if(32===t){return i|0}var e=2147483648>>t-1;return o(t,e&(s?i:i<<32-t),1)}function c(s){var i;for(i in t){if(t.hasOwnProperty(i)){this[i]=t[i]}}for(i in s){if(s.hasOwnProperty(i)){this[i]=s[i]}}}function e(u,e,o,s){var i=s/32,t,r,c=0,f,l,k;s=s&31;r=Math.min(o.length,e.length-i)-1;if(s){c=0;for(t=0;t<r;++t,++i){f=o[t];e[i]^=f>>>s^c;c=f<<32-s}}else{for(t=0;t<r;++t,++i){e[i]^=o[t]}}l=a(e[i]);e[i]^=o[t]>>>s^c;if(32!==l){e[i]=h(l,e[i],1)}r=r*32+l-s;u._mask=n(o,r);if(0===u._mask.length){u._mask=null}return r}function i(t){t=t.slice(0);var i=0,n=r(t);if(this._mask){i+=e(this,t,this._mask,i)}while(i<n){if(this._mask){throw new s("_mask must be null")}i+=e(this,t,this.nextMask(),i)}return t}t={blockBits:0,nextMask:function(){throw new l("nextMask not implemented")},crypt:i,encrypt:i,decrypt:i,setPosition:function(i){if(!this.setBlock){throw new s("(this) stream cipher can't seek position")}var t=i%this.blockBits;this.setBlock((i-t)/this.blockBits);if(0===t){this._mask=null}else{this._mask=this.nextMask();n(this._mask,t)}},getPosition:function(){if(!this.getBlock){throw new s("(this) stream cipher can't tell position")}var t=this._mask?r(this._mask):0;return this.getBlock()*this.blockBits-t}};return c}();sjcl.cipher.salsa20=function(){var s=sjcl.exception.invalid,c=sjcl.exception.bug,e=sjcl.bitArray.byteswapM,i,t,o;function r(t,i,e){this._rounds=e||20;if(this._rounds!==8&&this._rounds!==12&&this._rounds!==20){throw new s("invalid number of rounds for (X)Salsa20")}this._key=o(t,i,this._rounds);this._cache=this._key.slice(0);this._eos=false}i=[0,4,8,12,5,9,13,1,10,14,2,6,15,3,7,11,0,1,2,3,5,6,7,4,10,11,8,9,15,12,13,14];t=[1634760805,857760878,2036477234,1797285236];function h(s,k){var r,t,e,o,u,c,a,l,f,h,n;for(r=k||20;r>0;r-=2){for(e=0;e<32;){l=i[e++];f=i[e++];h=i[e++];n=i[e++];t=(o=s[l])+(a=s[n]);s[f]=u=s[f]^(t<<7|t>>>25);t=u+o^0;s[h]=c=s[h]^(t<<9|t>>>23);t=c+u;s[n]=a^=t<<13|t>>>19;t=a+c;s[l]=o^(t<<18|t>>>14)}}}function n(s,e,i){var t;if(!i){i=s.slice(0)}else{for(t=0;t<16;++t){i[t]=s[t]}}h(i,e);for(t=0;t<16;++t){i[t]=i[t]+s[t]^0}return i}function a(s,r,h){var i,o,e;o=[t[0],s[0],s[1],s[2],s[3],t[1],r[0],r[1],r[2],r[3],t[2],s[4],s[5],s[6],s[7],t[3]];i=n(o,h);for(e=0;e<16;++e){i[e]=i[e]-o[e]^0}return[i[0],i[5],i[10],i[15],i[6],i[7],i[8],i[9]]}o=function(n,i,l){var h=t[1],c=t[2],r,o;n=e(n.slice(0));i=i?e(i.slice(0)):[0,0];if(i.length===6&&n.length===8){n=a(n,i,l);i[0]=i[4];i[1]=i[5]}else if(i.length!==2){throw new s("invalid salsa20 nonce size")}if(n.length===4){h^=1<<25;c^=4;r=o=n}else if(n.length===8){r=n;o=n.slice(4)}else{throw new s("invalid salsa20 key size")}return[t[0],r[0],r[1],r[2],r[3],h,i[0],i[1],0,0,c,o[0],o[1],o[2],o[3],t[3]]};function l(t){return 0===(t[8]=t[8]+1^0)&&0===(t[9]=t[9]+1^0)}r.core=n;r.prototype=new sjcl.cipher.stream({blockBits:512,nextMask:function(){if(this._eos){throw new s("Salsa20 stream cipher reached maximum message length")}var t=e(n(this._key,this._rounds,this._cache));this._eos=l(this._key);return t},setBlock:function(t){this.setBlock2(t,0)},getBlock:function(){if(this._key[9]){throw new c("block index doesn't fit in 32 bits")}return this._key[8]},setBlock2:function(t,i){this._key[8]=t^0;this._key[9]=i^0;this._eos=false}});return r}();